select subscriber_id, notification_id, count(*) cnt_clicks
, min(created_at) as min_created_at
, max(created_at) as max_created_at
, count(notification_id) as cnt_notificatios
, count(created_at) as cnt_dates
--, count(notification_id ||"|"|| created_at_day) as cnt_notificatios_dates
--, count(distinct(notification_id)) as unq_notificatios
--, count(distinct(notification_id ||"|"|| created_at_day)) as unq_notificatios_dates
from (
select * --, substr(string(created_at),1,10) as created_at_day
--,EXTRACT(DAY FROM created_at AT TIME ZONE "UTC") AS the_day_utc,
from `jeeng-275018.production_msp.active_clicks`
where DATE(created_at) BETWEEN DATE_SUB(CURRENT_DATE(), INTERVAL 100 DAY) -- TODO change interval to parameter
AND (CURRENT_DATE()-1)
and notification_id IN( -- TODO change list of notifications to parameter
2126658
,2121340
,2119386
,2117190
,2111602
,2106281
,2104349
,2102149
,2096525
,2091202
,2089253
,2087053
,2081540
,2076215
,2074265
,2072079
,2066620
,2061306
,2059361
,2057160
,2051602
,2046287
,2044351
,2042144
,2036591
,2031272
,2029319
,2027063
,2021468
,2016150
,2014220
,2012014
,2006400
,2001081
,1999159
,1996948
,1991379
,1986060
,1984129
,1981903
,1976260
,1970952
,1969004
,1966839
,1961284
,1955964
,1954038
,1951838
,1946241
,1940911
,1938953
,1936740
,1931164
,1925837
,1923898
,1921675
,1900848
,1895512
,1893567
,1885733
,1880420
,1878489
,1876298
,1870674
,1865364
,1863420
,1861264
,1855783
,1850471
,1848526
,1846337
,1840691
,1835358
,1833410
,1831199
,1825528
,1820197
,1818272
,1816066
,1810450
,1809574
,1809092
,1808665
,1807523
,1806656
,1806195
,1805747
,1804578
,1803703
,1803249
,1802825
,1801676
,1800808
,1800348
,1799940
,1798894
,1798023
,1797570
,1797140
,1796014
,1795125
,1794663
,1794203
,1793055
,1792172
,1791717
,1791209
,1784154
,1783280
,1782824
,1782397
,1781357
,1780494
,1780049
,1779631
,1778612
,1777746
,1777291
,1776851
,1775749
,1774883
,1774392
,1773933
,1772815
,1771948
,1771478
,1770937
,1749326
,1748448
,1747977
,1747405
,1746290
,1745415
,1744930
,1744459
,1743307
,1742413
,1741681
,1741483
,1740396
,1739528
,1739056
,1738640
,1737607
,1736735
,1736289
,1735854
,1734721
,1733847
,1733379
,1732911
,1731718
,1730836
,1730374
,1729910
,1726879
,1725636
,1724752
,1724308
,1723827
,1722622
,1717943
,1716107
,1714143
,1709164
,1704497
,1702674
,1700741
,1695900
,1691233
,1689432
,1687435
,1682533
,1677853
,1676044
,1674075
,1669006
,1664300
,1662511
,1660532
,1660167
,1660086
,1659941
,1659743
,1659378
,1659288
,1658842
,1654141
,1652297
,1650274
,1645332
,1640638
,1638789
,1636818
,1631972
,1627282
,1625462
,1623478
,1618557
,1613840
,1612009
,1610007
,1604937
,1600194
,1598298
,1596169
,1591063
,1586319
,1584409
,1582273
,1563658
,1558932
,1557102
,1555071
,1550098
,1545403
,1543556
,1541568
,1536691
,1531982
,1530166
,1528174
,1523179
,1518448
,1516612
,1514592
,1509589
,1504855
,1503025
,1500958
,1495945
,1491228
,1489406
,1487364
,1482370
,1477659
,1475837
,1473790
,1468779
,1464049
,1462212
,1460216
,1455217
,1450510
,1448677
,1446698
,1441773
,1437064
,1435257
,1433232
,1428285
,1423568
,1421736
,1419699
,1414675
,1409960
,1408137
,1406093
,1380992
,1378949
,1373933
,1369212
,1367377
,1365365
,1360375
,1355671
,1353834
,1351821
,1346961
,1342259
,1340453
,1338455
,1333474
,1328761
,1326915
,1324871
,1319862
,1315143
,1313320
,1311246
,1306251
,1301529
,1299700
,1297661
,1292660
,1287960
,1286131
,1284099
,1279077
,1274361
,1272489
,1270486
,1265494
,1260780
,1258934
,1256960
,1252065
,1247343
,1245531
,1243538
,1238546
,1233824
,1231985
,1229961

)
)
group by subscriber_id, notification_id